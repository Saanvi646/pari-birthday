{% extends 'base.html' %}

{% block content %}
{% with era=letter.era|lower %}

<div class="min-h-screen py-10 px-4 transition-colors duration-500 relative
  {% if not letter.cover_image %}
    {% if era == 'midnights' %} bg-slate-900 
    {% elif era == 'red' %} bg-[#FFF5F5]
    {% elif era == 'folklore' %} bg-[#F3F4F6]
    {% else %} bg-[#FFF0F3] 
    {% endif %}
  {% endif %}">

  <!-- Background Image Backdrop -->
  {% if letter.cover_image %}
  <div class="fixed inset-0 z-0">
    <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('{{ letter.cover_image.url }}');">
    </div>
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
  </div>
  {% endif %}

  <div class="max-w-3xl mx-auto relative z-10">

    <!-- Navigation -->
    <a href="{% url 'letters' %}" class="inline-flex items-center gap-2 mb-8 px-4 py-2 rounded-full transition
         {% if era == 'midnights' %} text-slate-400 hover:bg-white/10 hover:text-white
         {% else %} text-gray-500 hover:bg-black/5 hover:text-gray-900
         {% endif %}">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
        class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
      <span>back to collection</span>
    </a>

    <!-- Letter Paper -->
    <article class="bg-white px-8 py-12 md:p-16 shadow-2xl relative mx-auto paper-texture
      {% if era == 'midnights' %} shadow-indigo-500/20 {% endif %}">

      <!-- Fold effect (top right corner) -->
      <div class="absolute top-0 right-0 border-t-[40px] border-r-[40px] border-t-[#f3f4f6] border-r-white shadow-sm">
      </div>

      <header class="mb-10 text-center">
        <span class="inline-block px-3 py-1 mb-4 text-xs font-bold tracking-widest uppercase rounded-full
          {% if era == 'midnights' %} bg-slate-100 text-slate-600
          {% elif era == 'red' %} bg-red-50 text-red-500
          {% elif era == 'folklore' %} bg-gray-100 text-gray-500
          {% else %} bg-pink-50 text-pink-500
          {% endif %}">
          {{ letter.get_era_display }} Era
        </span>

        <h1 class="text-3xl md:text-5xl font-serif text-gray-900 mb-2">
          {{ letter.title }}
        </h1>

        <time class="text-sm text-gray-400 font-sans">
          {{ letter.created_at|date:"F j, Y" }}
        </time>
      </header>

      <!-- Content -->
      <div
        class="prose prose-lg prose-p:font-['Caveat'] prose-p:text-2xl prose-p:leading-relaxed text-gray-700 mx-auto">
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap');

          .font-handwriting {
            font-family: 'Caveat', cursive;
          }
        </style>

        <div class="font-handwriting whitespace-pre-line">
          {{ letter.content }}
        </div>

      </div>

      <!-- Footer/Signature -->
      <div class="mt-16 pt-8 border-t border-gray-100 text-center">
        <p class="font-serif italic text-gray-400 text-sm">
          forever & always, <br>
          <span class="not-italic font-bold text-gray-600">{{ letter.author.username|title }}</span>
        </p>
      </div>

    </article>

  </div>

</div>
{% endwith %}
{% endblock %}